<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <title>同比地图</title>
        <meta name="keywords" content="地图, 双地图, 同比例放大">
        <meta name="description" content="可以同比例放大的地图">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">

        <style>
            body,
            html,
            #map_container {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                font-family: "微软雅黑";
                display: -webkit-flex; /* Safari */
                display: flex;
                flex-direction: column;
            }

            #map1_container,
            #map2_container {
                flex: 1;
                overflow: hidden;
                margin: 0;
                position: relative;
            }

            #map1,
            #map2 {
                height: 100%;
            }

            #map1-search,
            #map2-search {
                width: 100%;
                position: absolute;
                top: 10px;
                left: 10px;
                z-index: 100;
            }

            .tangram-suggestion-main {
                z-index: 100;
            }

            #zoomUp {
                position: absolute;
                bottom: 5px;
                right: 155px;
                z-index: 100;
            }

            #zoomDown {
                position: absolute;
                bottom: 5px;
                right: 120px;
                z-index: 100;
            }

            #switchMapStyle {
                position: absolute;
                bottom: 5px;
                right: 85px;
                z-index: 100;
            }

            #switchDirection {
                position: absolute;
                bottom: 5px;
                right: 45px;
                z-index: 100;
            }

            #swapContainer {
                position: absolute;
                bottom: 5px;
                right: 5px;
                z-index: 100;
            }

        </style>

        <script src="http://api.map.baidu.com/api?type=webgl&v=1.0&ak=9kKan8hqL7ufdILQDNIsMKPcqzTGaYzb"></script>

    </head>
    <body>
        <div id="map_container">
            <div id="map1_container">
                <div id="map1"></div>
                <div id="map1-search">
                    <input type="text" id="map1-search-input" size="20" placeholder="请输入地址" style="width:150px;"/>
                    <div id="map1-search-result" style="border:1px solid #C0C0C0;width:150px;height:auto; display:none;"></div>
                </div>
                <div id="zoomUp" onclick="zoomUp();">
                    <svg t="1605165558990" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1688" width="32" height="32">
                        <path d="M768 448a320 320 0 1 0-320 320 320 320 0 0 0 320-320z m64 0A384 384 0 1 1 448 64a384 384 0 0 1 384 384z" p-id="1689" fill="#484D55"></path>
                        <path d="M681.28 726.72a32 32 0 0 1 45.44-45.44l160 160a32 32 0 0 1-45.44 45.44zM320 480a32 32 0 0 1 0-64h256a32 32 0 0 1 0 64z" p-id="1690" fill="#484D55"></path>
                        <path d="M480 576a32 32 0 0 1-64 0v-256a32 32 0 0 1 64 0z" p-id="1691" fill="#484D55"></path>
                    </svg>
                </div>
                <div id="zoomDown" onclick="zoomDown();">
                    <svg t="1605165657200" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1972" width="32" height="32">
                        <path d="M768 448a320 320 0 1 0-320 320 320 320 0 0 0 320-320z m64 0A384 384 0 1 1 448 64a384 384 0 0 1 384 384z" p-id="1973" fill="#484D55"></path>
                        <path d="M681.28 726.72a32 32 0 0 1 45.44-45.44l160 160a32 32 0 0 1-45.44 45.44zM288 480a32 32 0 0 1 0-64h320a32 32 0 0 1 0 64z" p-id="1974" fill="#484D55"></path>
                    </svg>
                </div>
                <div id="switchMapStyle" onclick="switchMapStyle();">
                    <svg t="1605159422980" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4353" width="32" height="32">
                        <path fill="#484D55"
                              d="M234.0864 65.8432L51.2 234.0352l168.2432 182.8864 563.2 607.0784 182.8352-160.9216zM124.3648 234.0352l102.4-87.7568 102.4 102.4-102.4 87.7568-102.4-102.4z m248.6784 599.808l-29.2352 65.8432-65.8432 7.3216 51.2 43.8784L314.5216 1024l58.5216-29.2352L431.5648 1024l-7.3216-73.1648 43.8784-51.2-65.8432-7.3216-29.2352-58.5216z m-226.7648-299.8784l-43.8784 102.4-102.4 14.6432 73.1648 73.1648-14.6432 109.7216 87.7568-51.2 87.7568 51.2-14.6432-109.7216 73.1648-73.1648-102.4-14.6432zM819.2 0l-58.5216 131.6352L621.7216 153.6l102.4 102.4-21.9648 146.2784 124.3648-73.1648 124.3648 73.1648L928.9216 256 1024 153.6l-138.9568-21.9648L819.2 0z"
                              p-id="4354"></path>
                    </svg>
                </div>
                <div id="switchDirection" onclick="switchDirection();">
                    <svg t="1605145114922" class="icon" viewBox="0 0 1080 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1186" width="32" height="32">
                        <path id="svg_1" fill="none" d="m0,0l625.77778,0l0,739.55556l-625.77778,0l0,-739.55556z"/>
                        <path id="svg_2" fill="#484D55" d="m0,739.55556l0,-739.55556l625.77778,0l0,739.55556l-625.77778,0zm568.88889,-682.66667l-512,0l0,625.77778l512,0l0,-625.77778z"/>
                        <path id="svg_3" fill="none" d="m398.22222,455.11111l682.66667,0l0,568.88889l-682.66667,0l0,-568.88889z"/>
                        <path id="svg_4" fill="#484D55" d="m398.22222,1024l0,-568.88889l682.66667,0l0,568.88889l-682.66667,0zm625.77778,-512l-568.88889,0l0,455.11111l568.88889,0l0,-455.11111z"/>
                        <path id="svg_5" fill="#484D55"
                              d="m1080.88889,56.88889l0,142.22222a28.44444,28.44444 0 0 1 -56.88889,0l0,-142.22222l-142.22222,0a28.44444,28.44444 0 0 1 0,-56.88889l199.11111,0l0,56.88889zm-881.77778,967.11111l-199.11111,0l0,-28.44444l0,-170.95112a28.44444,28.44444 0 0 1 56.88889,0l0,142.50667l142.22222,0a28.44444,28.44444 0 0 1 0,56.88889z"/>
                    </svg>
                </div>
                <div id="swapContainer" onclick="swapContainer();">
                    <svg t="1605163423207" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8100" width="32" height="32">
                        <path fill="#484D55"
                              d="m103.466711,129.777819l0,775.444442l817.066651,0l0,-775.444442m-868.133321,-110.777772l919.199991,0a51.06667,55.388892 0 0 1 51.06667,55.388893l0,886.222201a51.06667,55.388892 0 0 1 -51.06667,55.388892l-919.199991,0a51.06667,55.388892 0 0 1 -51.06667,-55.388892l0,-886.222201a51.06667,55.388892 0 0 1 51.06667,-55.388893zm612.799994,221.555557l182.733328,164.166664l-182.733328,168.166664l0,-110.777784l-204.266669,0l0,-110.777772l203.069794,-1.298177l1.196875,-109.479595zm-306.399997,553.888872l-178.733328,-166.166664l178.733328,-166.166664l0,110.777784l204.266669,0l0,110.777772l-204.266669,0l0,110.777772z"
                              p-id="8101"></path>
                    </svg>
                </div>
            </div>
            <div id="map2_container">
                <div id="map2"></div>
                <div id="map2-search">
                    <input type="text" id="map2-search-input" size="20" placeholder="请输入地址" style="width:150px;"/>
                    <div id="map2-search-result" style="border:1px solid #C0C0C0;width:150px;height:auto; display:none;"></div>
                </div>
            </div>
        </div>
    </body>
</html>
<script>

    // 初始化位置：北京
    var centerAndZoom1 = [116.404, 39.915, 10];
    var centerAndZoom2 = [116.404, 39.915, 10];

    // 从参数中解析两张地图的中心位置
    var qs = location.search.substr(1).split('&');
    if (qs) {
        for (var i = 0; i < qs.length; i++) {
            switch (qs[i].substring(0, qs[i].indexOf('='))) {
                case "map1": {
                    centerAndZoom1 = qs[i].substring(qs[i].indexOf('=') + 1).split(',');
                    break;
                }
                case "map2": {
                    centerAndZoom2 = qs[i].substring(qs[i].indexOf('=') + 1).split(',');
                    break;
                }
                default:
                    break;
            }

        }
    }

    // 初始化地图
    var map1 = createMap("map1", centerAndZoom1[0], centerAndZoom1[1], centerAndZoom1[2]);
    var map2 = createMap("map2", centerAndZoom2[0], centerAndZoom2[1], centerAndZoom2[2]);

    // 初始化搜索框
    map1.initSearchInput();
    map2.initSearchInput();

    // 初始化同比缩放
    map1.addEventListener("zoomend", throttle(function (evt) {
        if (evt && evt.currentTarget && evt.currentTarget.zoomLevel) {
            map2.zoomTo(evt.currentTarget.zoomLevel);
        }
    }, 500));
    map2.addEventListener("zoomend", throttle(function (evt) {
        if (evt && evt.currentTarget && evt.currentTarget.zoomLevel) {
            map1.zoomTo(evt.currentTarget.zoomLevel);
        }
    }, 500));

    // 切换屏幕的分割方向
    function switchDirection() {
        var bodyD = document.getElementById("map_container");
        if (bodyD.style["flex-direction"] == "" || bodyD.style["flex-direction"] == "column") {
            bodyD.style["flex-direction"] = "row";
        } else {
            bodyD.style["flex-direction"] = "column";
        }
    }

    // 切换地图样式
    var styles = {
        select: "normal",
        normal: {
            styleJson: []
        },
        bigFont: {
            styleJson: [
                // 关闭所有
                {
                    "featureType": "districtlabel",
                    "elementType": "labels",
                    "stylers": {
                        "visibility": "off"
                    }
                }, {
                    "featureType": "districtlabel",
                    "elementType": "labels.icon",
                    "stylers": {
                        "visibility": "off"
                    }
                }, {
                    "featureType": "road",
                    "elementType": "geometry",
                    "stylers": {
                        "visibility": "off"
                    }
                }, {
                    "featureType": "road",
                    "elementType": "labels",
                    "stylers": {
                        "visibility": "off"
                    }
                }, {
                    "featureType": "highwaysign",
                    "elementType": "labels",
                    "stylers": {
                        "visibility": "off"
                    }
                }, {
                    "featureType": "highwaysign",
                    "elementType": "labels.icon",
                    "stylers": {
                        "visibility": "off"
                    }
                }, {
                    "featureType": "nationalwaysign",
                    "elementType": "labels",
                    "stylers": {
                        "visibility": "off"
                    }
                }, {
                    "featureType": "nationalwaysign",
                    "elementType": "labels.icon",
                    "stylers": {
                        "visibility": "off"
                    }
                }, {
                    "featureType": "provincialwaysign",
                    "elementType": "labels",
                    "stylers": {
                        "visibility": "off"
                    }
                }, {
                    "featureType": "provincialwaysign",
                    "elementType": "labels.icon",
                    "stylers": {
                        "visibility": "off"
                    }
                }, {
                    "featureType": "tertiarywaysign",
                    "elementType": "labels",
                    "stylers": {
                        "visibility": "off"
                    }
                }, {
                    "featureType": "tertiarywaysign",
                    "elementType": "labels.icon",
                    "stylers": {
                        "visibility": "off"
                    }
                },

                // 标注公路
                {
                    "featureType": "highway",
                    "elementType": "geometry",
                    "stylers": {
                        "visibility": "on"
                    }
                }, {
                    "featureType": "nationalway",
                    "elementType": "geometry",
                    "stylers": {
                        "visibility": "on"
                    }
                }, {
                    "featureType": "provincialway",
                    "elementType": "geometry",
                    "stylers": {
                        "visibility": "on"
                    }
                }, {
                    "featureType": "cityhighway",
                    "elementType": "geometry",
                    "stylers": {
                        "visibility": "on"
                    }
                }, {
                    "featureType": "arterial",
                    "elementType": "geometry",
                    "stylers": {
                        "visibility": "on"
                    }
                }, {
                    "featureType": "tertiaryway",
                    "elementType": "geometry",
                    "stylers": {
                        "visibility": "on"
                    }
                }, {
                    "featureType": "fourlevelway",
                    "elementType": "geometry",
                    "stylers": {
                        "visibility": "on"
                    }
                }, {
                    "featureType": "local",
                    "elementType": "geometry",
                    "stylers": {
                        "visibility": "on"
                    }
                },

                // 标注地铁
                {
                    "featureType": "subway",
                    "elementType": "geometry",
                    "stylers": {
                        "visibility": "on"
                    }
                },

                // 标注市区县
                {
                    "featureType": "city",
                    "elementType": "labels",
                    "stylers": {
                        "visibility": "on"
                    }
                }, {
                    "featureType": "city",
                    "elementType": "labels.text",
                    "stylers": {
                        "fontsize": 80
                    }
                }, {
                    "featureType": "city",
                    "elementType": "labels.text.fill",
                    "stylers": {
                        "color": "#000000ff"
                    }
                }, {
                    "featureType": "district",
                    "elementType": "labels",
                    "stylers": {
                        "visibility": "on"
                    }
                }, {
                    "featureType": "district",
                    "elementType": "labels.text",
                    "stylers": {
                        "fontsize": 60
                    }
                }, {
                    "featureType": "district",
                    "elementType": "labels.text.fill",
                    "stylers": {
                        "color": "#f01414b3"
                    }
                },

                // 标注车站和机场
                {
                    "featureType": "transportationlabel",
                    "elementType": "labels",
                    "stylers": {
                        "visibility": "on"
                    }
                }, {
                    "featureType": "transportationlabel",
                    "elementType": "labels.icon",
                    "stylers": {
                        "visibility": "on"
                    }
                }, {
                    "featureType": "transportationlabel",
                    "elementType": "labels.text",
                    "stylers": {
                        "fontsize": 50
                    }
                }, {
                    "featureType": "airportlabel",
                    "elementType": "labels",
                    "stylers": {
                        "visibility": "on"
                    }
                }, {
                    "featureType": "airportlabel",
                    "elementType": "labels.icon",
                    "stylers": {
                        "visibility": "on"
                    }
                }, {
                    "featureType": "airportlabel",
                    "elementType": "labels.text",
                    "stylers": {
                        "fontsize": 50
                    }
                },


                // 兴趣点

                {
                    "featureType": "poilabel",
                    "elementType": "labels.icon",
                    "stylers": {
                        "visibility": "on"
                    }
                }, {
                    "featureType": "poilabel",
                    "elementType": "labels",
                    "stylers": {
                        "visibility": "on"
                    }
                }, {
                    "featureType": "poilabel",
                    "elementType": "labels.text",
                    "stylers": {
                        "fontsize": 40
                    }
                }, {
                    "featureType": "poilabel",
                    "elementType": "labels",
                    "stylers": {
                        "visibility": "off",
                        "level": "9"
                    }
                }, {
                    "featureType": "poilabel",
                    "elementType": "labels",
                    "stylers": {
                        "visibility": "off",
                        "level": "10"
                    }
                }, {
                    "featureType": "poilabel",
                    "elementType": "labels",
                    "stylers": {
                        "visibility": "off",
                        "level": "11"
                    }
                }, {
                    "featureType": "poilabel",
                    "elementType": "labels",
                    "stylers": {
                        "visibility": "off",
                        "level": "12"
                    }
                }, {
                    "featureType": "poilabel",
                    "elementType": "labels",
                    "stylers": {
                        "visibility": "off",
                        "level": "13"
                    }
                }, {
                    "featureType": "poilabel",
                    "elementType": "labels.icon",
                    "stylers": {
                        "visibility": "off",
                        "level": "9"
                    }
                }, {
                    "featureType": "poilabel",
                    "elementType": "labels.icon",
                    "stylers": {
                        "visibility": "off",
                        "level": "10"
                    }
                }, {
                    "featureType": "poilabel",
                    "elementType": "labels.icon",
                    "stylers": {
                        "visibility": "off",
                        "level": "11"
                    }
                }, {
                    "featureType": "poilabel",
                    "elementType": "labels.icon",
                    "stylers": {
                        "visibility": "off",
                        "level": "12"
                    }
                }, {
                    "featureType": "poilabel",
                    "elementType": "labels.icon",
                    "stylers": {
                        "visibility": "off",
                        "level": "13"
                    }
                }

            ]
        }
    };

    function switchMapStyle() {
        if (styles.select == "normal") {
            styles.select = "bigFont";
        } else {
            styles.select = "normal";
        }
        map1.setMapStyleV2(styles[styles.select]);
        setTimeout(() => map2.setMapStyleV2(styles[styles.select]), 500);
    }


    // 交换两幅地图的位置
    var firstContainer = 1;

    function swapContainer() {
        var a1 = document.getElementById("map1_container");
        var a2 = document.getElementById("map2_container");
        if (firstContainer == 1) {
            a1.parentNode.insertBefore(a2, a1);
            firstContainer = 2;
        } else {
            a2.parentNode.insertBefore(a1, a2);
            firstContainer = 1;
        }
    }

    // 缩放微调
    function zoomUp() {
        var zoom = map1.getZoom() + 0.05;
        map1.zoomTo(zoom);
        map2.zoomTo(zoom);
    }

    function zoomDown() {
        var zoom = map1.getZoom() - 0.05;
        map1.zoomTo(zoom);
        map2.zoomTo(zoom);
    }

    // 创建地图
    function createMap(mapDivId, x, y, zoom, mayStyle, labelStyle, boundaryStyle) {

        // GL版命名空间为BMapGL
        // 按住鼠标右键，修改倾斜角和角度
        var map = new BMapGL.Map(mapDivId);    // 创建Map实例
        map.centerAndZoom(new BMapGL.Point(x, y), zoom);  // 初始化地图,设置中心点坐标和地图级别
        map.enableScrollWheelZoom(true);     //标注鼠标滚轮缩放
        map.addControl(new BMapGL.ScaleControl()); // 添加比例尺控件

        // 自定义文本标注样式
        if (mayStyle) {
            map.setMapStyleV2(mayStyle);
        }

        // 标注函数
        map.markPoint = function (x, y, lable) {
            var m = new BMapGL.Marker(new BMapGL.Point(x, y));
            if (lable) {
                var l = new BMapGL.Label(lable);
                if (labelStyle) {
                    l.setStyle(labelStyle);
                }
                m.setLabel(l);
            }
            map.addOverlay(m);
        };

        // 边界函数
        var bdary = new BMapGL.Boundary();
        map.drawBoundary = function (place) {
            bdary.get(place, function (rs) {       //获取行政区域
                var count = rs.boundaries.length; //行政区域的点有多少个
                if (count === 0) {
                    alert('未能获取当前输入行政区域');
                    return;
                }
                var pointArray = [];
                for (var i = 0; i < count; i++) {
                    //建立多边形覆盖物
                    var ply = new BMapGL.Polygon(rs.boundaries[i], boundaryStyle);
                    map.addOverlay(ply);  //添加覆盖物
                    pointArray = pointArray.concat(ply.getPath());
                }
            });
        };

        // 搜索框初始化函数
        map.initSearchInput = function (suggestInputId, searchResultPanelId) {

            if (!suggestInputId) suggestInputId = mapDivId + "-search-input";
            if (!searchResultPanelId) searchResultPanelId = mapDivId + "-search-result";

            function G(id) {
                return document.getElementById(id);
            }

            //建立一个自动完成的对象
            var ac = new BMapGL.Autocomplete({
                "input": suggestInputId, "location": map
            });

            ac.addEventListener("onhighlight", function (e) {  //鼠标放在下拉列表上的事件
                var str = "";
                var _value = e.fromitem.value;
                var value = "";
                if (e.fromitem.index > -1) {
                    value = _value.province + _value.city + _value.district + _value.street + _value.business;
                }
                str = "FromItem<br />index = " + e.fromitem.index + "<br />value = " + value;

                value = "";
                if (e.toitem.index > -1) {
                    _value = e.toitem.value;
                    value = _value.province + _value.city + _value.district + _value.street + _value.business;
                }
                str += "<br />ToItem<br />index = " + e.toitem.index + "<br />value = " + value;
                G(searchResultPanelId).innerHTML = str;
            });

            var myValue;
            ac.addEventListener("onconfirm", function (e) {    //鼠标点击下拉列表后的事件
                var _value = e.item.value;
                myValue = _value.province + _value.city + _value.district + _value.street + _value.business;
                G(searchResultPanelId).innerHTML = "onconfirm<br />index = " + e.item.index + "<br />myValue = " + myValue;

                setPlace();
            });

            function setPlace() {
                function myFun() {
                    var pp = local.getResults().getPoi(0).point;    //获取第一个智能搜索的结果
                    map.centerAndZoom(pp, 18);
                    map.addOverlay(new BMapGL.Marker(pp));    //添加标注
                }

                var local = new BMapGL.LocalSearch(map, { //智能搜索
                    onSearchComplete: myFun
                });
                local.search(myValue);
            }
        };

        return map;
    }

    function throttle(fun, delay) {
        var timer = null;
        var startTime = Date.now();

        return function () {
            var curTime = Date.now();
            var remaining = delay - (curTime - startTime);  // 计算出两次触发的时间间隔有没有大余delay
            var context = this;
            var args = arguments;

            clearTimeout(timer);
            if (remaining <= 0) {
                fun.apply(context, args);
                startTime = Date.now();  // 如果两次触发时间大余delay，则立马触发一次任务函数并且更新起始时间戳
            } else {
                timer = setTimeout(fun, remaining);  // 如果两次触发时间小于delay， 则改变定时器时间保证delay时间一定触发任务函数
            }
        }
    }

</script>
